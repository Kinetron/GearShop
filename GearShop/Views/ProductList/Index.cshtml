@{
	Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
	.searchInput {
		padding: 10px;
	}

	.searchButton {
		padding: 10px;
	}
</style>

<div id="mainPanel">
	<div class="searchInput">
		<input id="searchInput" type="text" />
		<button id="searchButton" type="button">Поиск</button>
	</div>
	
	<div id="tbProductList"></div>
	<div id="productsPaginator"></div>
	<label id="recordCountInfo"></label>
	<div id="grid"></div>
</div>


<script type="text/javascript">
$(document).ready(function() {
	@*Обновляет данные пейдженатора-количество строк и страниц.*@
	function UpdatePaginator(searchText) {
		$.ajax({
			type: "GET",
			url: '/ProductList/GetPaginateData',
			data: { searchText: searchText },
			dataType: "json",
			error: function (error) {
				console.log(error);
			},
			context: this,
			success: function (response) {
				$('#recordCountInfo').text(`Найдено ${response.totalRecords} товаров`);
				$('#productsPaginator').puipaginator({
					totalRecords: response.totalRecords,
					rows: response.rows
				});
			}
		});
	}

	function UpdateData(searchText) {
			$('#tbProductList').puidatatable('reload');
			UpdatePaginator(searchText);
	}

	$('#mainPanel').puipanel();
		$('#searchInput').puiinputtext();

		let currentPage = 1;
		let searchText = '';

		$('#searchButton').puibutton({
			click: function(event) {
				searchText = $('#searchInput').val();
				UpdateData(searchText);
			}
		});

		$("#searchInput").on('keyup', function (e) {
		if (e.key === 'Enter' || e.keyCode === 13) {
			searchText = $('#searchInput').val();
			UpdateData(searchText);
		}
	});
	
	$('#productsPaginator').puipaginator({
			paginate: function(event, state) {
				currentPage = state.page + 1;
				$('#tbProductList').puidatatable('reload');
			}
		});
		
		UpdatePaginator(searchText);

		$('#tbProductList').puidatatable({
			caption: 'Список продуктов',
			selectionMode: 'single',
			columns: [
				{ field: 'name', headerText: 'Наименование' },
				{ field: 'quantity', headerText: 'В наличии' },
				{ field: 'cost', headerText: 'Цена, Р' },
			],
			datasource: function(callback) {
				$.ajax({
					type: "GET",
					url: '@Url.Action("GetProductList", "ProductList")',
					data: { currentPage: currentPage, searchText: searchText },
					dataType: "json",
					error: function(error) {
						console.log(error);
					},
					context: this,
					success: function(response) {
						callback.call(this, response);
					}
				});
			}
		});

		$('#tbProductList').puidatatable({
		rowSelect: function(event, data) {
			 console.log(data);
			}
		});
	
		$('#grid').puidatagrid({
			paginator: {
				rows: 9
			},
			header: 'Local Javascript Array',
			datasource: [
				{ 'brand': 'Volkswagen', 'year': 2012, 'color': 'White', 'vin': 'dsad231ff' },
				{ 'brand': 'Audi', 'year': 2011, 'color': 'Black', 'vin': 'gwregre345' },
				{ 'brand': 'Renault', 'year': 2005, 'color': 'Gray', 'vin': 'h354htr' },
				{ 'brand': 'BMW', 'year': 2003, 'color': 'Blue', 'vin': 'j6w54qgh' },
				{ 'brand': 'Ford', 'year': 1995, 'color': 'White', 'vin': 'hrtwy34' },
				{ 'brand': 'Fiat', 'year': 2005, 'color': 'Black', 'vin': 'jejtyj' },
				{ 'brand': 'Honda', 'year': 2012, 'color': 'Yellow', 'vin': 'g43gr' },
				{ 'brand': 'Volvo', 'year': 2013, 'color': 'White', 'vin': 'greg34' },
				{ 'brand': 'Ford', 'year': 2000, 'color': 'Black', 'vin': 'h54hw5' },
				{ 'brand': 'BMW', 'year': 2013, 'color': 'Red', 'vin': '245t2s' },
				{ 'brand': 'Jaguar', 'year': 2011, 'color': 'Blue', 'vin': 'few234' },
				{ 'brand': 'Ford', 'year': 2010, 'color': 'White', 'vin': 'bfnt23' },
				{ 'brand': 'BMW', 'year': 2011, 'color': 'Green', 'vin': 'aad423' },
				{ 'brand': 'Mercedes', 'year': 2012, 'color': 'Black', 'vin': 'vx23f2' },
				{ 'brand': 'Fiat', 'year': 2014, 'color': 'Grey', 'vin': 'vxr23fd' },
				{ 'brand': 'Renault', 'year': 2015, 'color': 'Blue', 'vin': 'vxc23f' },
				{ 'brand': 'Volvo', 'year': 2015, 'color': 'Yellow', 'vin': 'vxcff4' },
				{ 'brand': 'Volvo', 'year': 2015, 'color': 'White', 'vin': 'ht3w1d' },
				{ 'brand': 'Renault', 'year': 2013, 'color': 'Black', 'vin': 'az12s2' },
				{ 'brand': 'Fiat', 'year': 2015, 'color': 'Green', 'vin': 'ds12d1' },
				{ 'brand': 'Volkswagen', 'year': 2001, 'color': 'Grey', 'vin': 'vsd3f2' },
				{ 'brand': 'Volvo', 'year': 2011, 'color': 'Blue', 'vin': 'dsy4g22' },
				{ 'brand': 'BMW', 'year': 1996, 'color': 'Black', 'vin': 'h3g254' },
				{ 'brand': 'Audi', 'year': 2005, 'color': 'Red', 'vin': 'g54gwg' },
				{ 'brand': 'Ford', 'year': 2011, 'color': 'Blue', 'vin': '14ffqf4' },
				{ 'brand': 'BMW', 'year': 2015, 'color': 'Black', 'vin': 'h465he6' },
				{ 'brand': 'Jaguar', 'year': 2010, 'color': 'White', 'vin': 'dsf4frt' },
				{ 'brand': 'Jaguar', 'year': 2009, 'color': 'Red', 'vin': 'g6hehr' },
			],
			content: function (car) {
				return $('<div title="' + car.vin + '"><img src="/images/' + car.brand +
					'.gif" /><div class="car-detail">' + car.year + ' - ' + car.color + '</div><button>Купить</button></div>').puipanel();
			}
		});
});
</script>
	 